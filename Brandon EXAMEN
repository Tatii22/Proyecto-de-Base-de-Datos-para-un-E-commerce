DELIMITER $$

CREATE FUNCTION fn_CalcularRentabilidadProducto(p_id_producto INT) 
RETURNS DECIMAL(10,2)
DETERMINISTIC
BEGIN
DECLARE v_precio DECIMAL(10,2);
DECLARE v_congelado DECIMAL(10,2);
DECLARE v_return DECIMAL(10,2);
DECLARE total DECIMAL (10,2);



SELECT precio INTO v_precio FROM productos;
SELECT precio_unitario_congelado INTO v_congelado FROM detalle_ventas
ORDER BY fecha_venta DESC
LIMIT 1;

SET v_return = v_precio - IFNULL(v_congelado, 0);


RETURN v_return;
END $$

DELIMITER;
SELECT fn_CalcularRentabilidadProducto (5) AS Rentabilidad;
